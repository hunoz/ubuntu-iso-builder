    # 6. Configure user profiles with custom settings
    - |
        cat >> /target/home/{{ admin_username }}/.bashrc << 'BASHRC'

        # Custom bash configuration
        export EDITOR=vim
        export VISUAL=vim

        # Custom aliases
        alias ll='ls -lah'
        alias update='sudo apt-get update && sudo apt-get upgrade'

        # Custom prompt
        PS1='\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '
        BASHRC

    # Set custom vim configuration
    - |
        cat > /target/home/{{ admin_username }}/.vimrc << 'VIMRC'
        set number
        set expandtab
        set tabstop=4
        set shiftwidth=4
        syntax on
        set background=dark
        VIMRC

    # Create custom profile script in /etc/profile.d
    - |
        cat > /target/etc/profile.d/custom-settings.sh << 'PROFILE'
        #!/bin/bash
        # System-wide custom settings
        export HISTSIZE=10000
        export HISTFILESIZE=20000
        PROFILE

    # Fix ownership of user files
    - curtin in-target -- chown -R {{ admin_username }}:{{ admin_username }} /home/{{ admin_username }}
